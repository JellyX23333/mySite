<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>关于我</title>

  <link rel="stylesheet" href="style.css" />
  <link rel="icon" href="favicon.ico" />

  <!-- Vue 3 CDN -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
</head>

<body>
<div id="app">

  <h1 style="float:right;margin-right:10px;">关于我</h1>

  <!-- Top icons -->
  <ul style="list-style:none; padding:0; margin:0; display:flex; align-items:center; gap:10px;">
    <li>
      <button @click="changeLanguage" style="background:transparent;border:none;">
        <img src="https://cdn3.iconfinder.com/data/icons/design-tools-15/24/_translation-1024.png"
             width="30">
      </button>
    </li>

    <li>
      <a href="https://github.com/jellyx23333">
        <img src="https://github.githubassets.com/assets/GitHub-Mark-ea2971cee799.png"
             width="30">
      </a>
    </li>

    <li>
      <a class="tooltip-wrapper" style="position:relative;">
        <img src="https://cdn2.iconfinder.com/data/icons/email-line-2/48/email_link_mail-512.png"
             width="30">
        <span class="tooltip">izeping#outlook.com</span>
      </a>
    </li>

    <li>
      <a href="https://www.linkedin.com/in/zeping-xu-052b13356/">
        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR6KyW5WYCdoJ32KzNbJH6NMm43byKYpZuo7g&s"
             width="30">
      </a>
    </li>

    <li>
      <label class="switch">
        <input type="checkbox" v-model="darkMode" @change="toggleDarkMode">
        <span class="slider round"></span>
      </label>
    </li>
  </ul>

  <div style="clear:both;"></div>

  <!-- Skills -->
  <div class="block">
    <h2>技能</h2>
    <ul>
      <li>分子生物学 (Molecular Biology)</li>
      <li>细胞生物学 (Cell Biology)</li>
      <li>统计分析 (Statistical Analysis)</li>
      <li>Python, Lua, Julia, R 和 MATLAB</li>
      <li>Arduino</li>
      <li>Linux 系统</li>
      <li>咖啡师</li>
      <li>日语 (N2)</li>
      <li>普通话 (母语)</li>
      <li>吴语 (母语)</li>
    </ul>
  </div>

  <!-- Projects -->
  <div class="block">
    <h2>项目经历</h2>

    <h3>已完成</h3>
    <ul style="list-style:none">

      <li>
        <span>个人网站 </span>
        <span class="censored">本站</span>
      </li>

      <!-- Typed projects -->
      <li v-for="(p, i) in projects" v-if="showMore" :key="i">
        <span class="typing">{{ p.typed }}</span>

        <a v-if="p.typed === p.text" :href="p.link" target="_blank">
          <img src="https://cdn0.iconfinder.com/data/icons/pixon-1/24/Link_hyperlink-1024.png"
               width="18" style="margin-left:6px;">
        </a>
      </li>

      <li>
        <button @click="toggleProjects"
                style="background:transparent;border:none;font-size:17px;color:#5a788a;cursor:pointer">
          {{ showMore ? "收起" : "更多 ..." }}
        </button>
      </li>

    </ul>
  </div>
    <hr>
    <div class="block">
        <h2>教育经历</h2>
        <ul>
            <li>理学学士，墨尔本大学 (University of Melbourne)，在读</li>
            <li>高中毕业证书 (HSC)，Epping Boys High School，2023年毕业</li>
        </ul>
    </div>

    <hr>
    <div class="block">
        <h2>工作经历</h2>
        <ul>
            <li>餐厅副经理，Young Barons Woy Woy，2022年12月 - 2023年12月 <a href="https://www.youngbarons.com/"><img src="https://cdn0.iconfinder.com/data/icons/pixon-1/24/Link_hyperlink-1024.png" width="20" height="20" alt="hyperlink icon"></a></li>
            <li>帮厨，Burwood 夜市章鱼烧，2020年1月 – 2020年3月</li>
            <li>清洁工，Chatswood Queen Bakery，2019年6月 – 2019年12月</li>
        </ul>
    </div>

    <hr>
    <div class="block">
        <h2>兴趣爱好</h2>
        <ul>
            <li>徒步</li>
            <li>攀岩</li>
            <li>潜水</li>
            <li>摄影</li>
            <li>陶艺</li>
        </ul>
    </div>

    <hr>
    <div class="block">
        <h2>成就与社会实践</h2>
        <ul>
            <li>爱丁堡公爵奖 (金奖)</li>
            <li>植被恢复志愿者 (Bush Regeneration)，2022年1月-2024年2月</li>
        </ul>
    </div>

    <hr>
    <div class="commentBlock">
      <p>留言板</p>

      <div class="newComment">
        <input type="text" placeholder="姓名" v-model="name" style="display:block;width:49%;margin-bottom:10px;">
        <div >
        <input type="email" placeholder="邮箱" v-model="email" style="display:block;width:49%;margin-bottom:10px;">
        <p style="color:red;font-size:smaller">{{invalidEmail? "请输入有效的邮箱地址":""}}</p>
        </div>
        <textarea placeholder="留言内容" v-model="commentText" style="display:block;width:100%;height:4em;margin-bottom:10px;"></textarea>
        <p style="color:red;font-size:smaller">{{emptyComment? "留言不能为空":""}}</p>
        <button @click="addComment" type='button' style="background:transparent;border:1px solid #5a788a;border-radius:5px;">提交</button>
      </div>

      <div class="comment" v-for="(comment, i) in comments.slice(0, 5)">
        <p><strong>{{ comment.name }}:</strong> {{ comment.comment }}</p>
      </div>

      <button v-if="comments.length > 5" @click="toggleComments"
        style="background:transparent;border:none;font-size:17px;color:#5a788a;cursor:pointer">
        {{ showMoreComments ? "收起" : "更多 ..." }}
      </button>
    </div>
</div>

<!-- Vue logic -->
<script>
const { createApp, ref, onMounted } = Vue

createApp({
  setup() {
    const showMore = ref(false)
    const darkMode = ref(localStorage.getItem("darkMode") === "enabled")

    const projects = ref([
      {
        text: "哔哩哔哩视频修改器", // bilibili video
        link: "https://github.com/JellyX23333/BilibiliVideoChanger",
        typed: ""
      },
      {
        text: "日语练习工具", // japanese practice
        link: "https://github.com/JellyX23333/HiraganaKanji-Practice",
        typed: ""
      }
    ])

    function typeProject(index, speed = 40) {
      const p = projects.value[index]
      p.typed = ""
      let i = 0

      const timer = setInterval(() => {
        p.typed += p.text[i]
        i++
        if (i >= p.text.length) clearInterval(timer)
      }, speed)
    }

    function toggleProjects() {
      showMore.value = !showMore.value

      if (showMore.value) {
        projects.value.forEach(p => p.typed = "")
        typeProject(0)
        setTimeout(() => typeProject(1), 400)
      }
    }

    function toggleDarkMode() {
      document.documentElement.classList.toggle("dark-mode", darkMode.value)
      localStorage.setItem("darkMode", darkMode.value ? "enabled" : "disabled")
    }

    function changeLanguage() {
      // Logic assumes if current lang is en, go to zh, otherwise go to en.
      // Since this file is now the Chinese version, it should likely link back to index.html
      const lang = document.documentElement.lang
      window.location.href = lang === "en" ? "index.zh.html" : "index.html"
    }

    onMounted(() => {
      if (darkMode.value) {
        document.documentElement.classList.add("dark-mode")
      }
    })

    // set reactive state for comment components
    // 1. Declare the reactive variables here
  const name = ref("");
  const email = ref("");
  const commentText = ref(""); // Renamed to avoid conflict

  const invalidEmail = ref(false);
  const emptyComment = ref(false);

  // 1. Create reactive data
  const comments = ref([]);

    // push comments
    function addComment() {
      const comment = {
        name: name.value,
        email: email.value,
        comment: commentText.value
      }

      // check email
      const emailRegex = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
      if (!emailRegex.test(email.value)) {
        invalidEmail.value=true;
        return;
      }
      else{
        invalidEmail.value=false;
      }

      // check comment
      if (commentText.value === "") {
        emptyComment.value=true;
        return;
      }
      else{
        emptyComment.value=false;
      }

      fetch("/comment", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify(comment)
    })
    .then(response => {
      if (!response.ok) throw new Error("Server error");
      // Success: Add to list and clear inputs
      comments.value.push(comment); 
      name.value = "";
      email.value = "";
      commentText.value = "";
    })
    .catch(error => console.error("Error:", error));
    }

    // fetch comment on mount
    // Define the fetch function
    const fetchComments = async () => {
      try {
        // Using 'foo' as requested
        const response = await fetch('/comment');
        
        if (!response.ok) {
           throw new Error(`Error: ${response.status}`);
        }

        const data = await response.json();
        comments.value = data; 
      } catch (error) {
        console.error("Failed to fetch:", error);
      }
    };

    // Run fetch when app mounts
    onMounted(() => {
      console.log('Fetching comments...');
      fetchComments();
    });

    return {
      name,
      email,
      commentText,
      invalidEmail,
      emptyComment,
      showMore,
      projects,
      darkMode,
      toggleProjects,
      toggleDarkMode,
      changeLanguage,
      addComment,
      comments,
      fetchComments
    }
  }
}).mount("#app")
</script>

</body>
</html>